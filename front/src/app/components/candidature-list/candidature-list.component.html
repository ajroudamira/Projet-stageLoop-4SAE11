<body class="sb-nav-fixed">
  <app-navbar></app-navbar>
  <div id="layoutSidenav">
    <app-layout-static></app-layout-static>
    <div id="layoutSidenav_content">
      <main>
        <div class="container-fluid px-4">
          <h1 class="mt-4">📋 Liste des Candidatures</h1>
          <ol class="breadcrumb mb-4">
            <li class="breadcrumb-item"><a routerLink="/back-office">Dashboard</a></li>
            <li class="breadcrumb-item active">Candidatures</li>
          </ol>

          <!-- SECTION DU GRAPHIQUE -->
          <div class="card mb-4">
            <div class="card-header">
              <i class="fas fa-chart-pie me-1"></i> Statistiques des Candidatures par Statut
            </div>
            <div class="card-body text-center">
              <canvas #candidatureChart style="max-width: 400px; height: 300px;"></canvas>
            </div>
          </div>

          <!-- SECTION DES ACTIONS -->
          <div class="mb-4">
            <button (click)="verifierCandidaturesExpirees()" class="btn btn-warning me-2">
              Vérifier les candidatures expirées
            </button>
            <button (click)="supprimerCandidaturesAnciennes()" class="btn btn-danger">
              Supprimer les candidatures anciennes
            </button>
          </div>

          <!-- SECTION DE LA LISTE DES CANDIDATURES -->
          <div class="card mb-4">
            <div class="card-header">
              <i class="fas fa-table me-1"></i> 📋 Liste des candidatures
            </div>
            <div class="card-body">
              <!-- Barre de recherche -->
              <div class="mb-3">
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="keyword"
                  (input)="searchCandidatures()"
                  placeholder="🔍 Rechercher par étudiant, statut, ou date..."
                />
              </div>

              <!-- Loader de chargement -->
              <div *ngIf="loading" class="text-center">
                <i class="fas fa-spinner fa-spin"></i> Chargement...
              </div>

              <!-- Liste des candidatures -->
              <div class="row">
                <div class="col-md-6 col-lg-4" *ngFor="let candidature of listCandidature">
                  <div class="card shadow-lg rounded-lg mb-4 p-3" style="background-color: #ffffff;">
                    <div class="card-body text-center">
                      <h5 class="card-title font-weight-bold text-primary">
                        👤 {{ candidature.etudiant.nom }} {{ candidature.etudiant.prenom }}
                      </h5>
                      <p class="card-text"><strong>Date :</strong> {{ candidature.dateCandidature | date:'shortDate' }}</p>
                      <p class="card-text"><strong>Statut :</strong> {{ candidature.statut }}</p>

                      <!-- Afficher la lettre de motivation et le lien vers le CV -->
                      <div *ngIf="candidature">
                        <p><strong>Lettre de motivation :</strong></p>
                        <pre>{{ candidature.lettreMotivation }}</pre> <!-- Affiche la lettre de motivation -->
                        
                        <p><strong>CV :</strong></p>
                        <a href="{{ candidature.cvUrl }}" target="_blank">Télécharger le CV</a> <!-- Lien vers le CV -->
                      </div>

                      <!-- Boutons d'action -->
                      <button class="btn btn-info mt-2" (click)="viewCv(candidature.id, candidature.cvUrl)">
                        <i class="fas fa-eye"></i> Voir CV
                      </button>

                      <button class="btn btn-warning mt-2" (click)="editCandidature(candidature.id)">
                        <i class="fas fa-edit"></i> Modifier
                      </button>
                      <button class="btn btn-danger mt-2" (click)="deleteCandidature(candidature.id)">
                        <i class="fas fa-trash"></i> Supprimer
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>
      </main>
    </div>
  </div>
</body>
